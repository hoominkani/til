# Haskell Day 2018

 - 開催日時：2018年11月10日
    - [copass link](https://haskell-jp.connpass.com/event/92617/)

## 「作りながら学ぶHaskell入門」を使ったハンズオン

## haskellを導入した話(khibinoさん)

### Perlに変わるGlue言語を導入したくなった
 - メンテできる人がいない
 - 実行前の検査が弱い　など

### 欲しかった機能
  - 実行前の検査
  - スクリプト実行
  - Unixとの親和性
  - その他検討した言語 Lispなど

### 2010 04-くらいから導入
 - 新規開発するものに関してはHaskellを導入
 - ファイル操作・プロセス制御中心

### 気づき
 - Parser Combinatorが使いやすいので、テキスト処理が書きやすい
    - トラフィックデータ加工
    - 全文ログ検索にシステム向けにIRCログを加工
    - 認証データの加工処理、データ移行
    - ビルドシステム（Debianzing IBM DB2）
 - STMがあるので、状態のあるマルチスレッドプログラムが書きやすい
 - Domain Specific language(DSL)が定義しやすい
  - Monad
  - Haskell Relational Record(自作した)

### Haskell Relational Recordの紹介
 - SQLを組み合わせるHaskell内DSL
 - SQLの誤りをコンパイル時に発見
 - 合成可能&型安全

### Q&A
 - Haskellはメモリでハマりやすいので、最適な型指定を考えることが大事

## Haskell／Servantで行う安全かつ高速なAPI開発(nakaji-dayoさん)
- 開催日時：2018年11月10日
   - [copass link](https://haskell-jp.connpass.com/event/92617/)

##「作りながら学ぶHaskell入門」を使ったハンズオン
##haskellを導入した話(khibinoさん)

### Perlに変わるGlue言語を導入したくなった
- メンテできる人がいない
- 実行前の検査が弱い　など

### 欲しかった機能
 - 実行前の検査
 - スクリプト実行
 - Unixとの親和性
 - その他検討した言語 Lispなど

### 2010 04-くらいから導入
- 新規開発するものに関してはHaskellを導入
- ファイル操作・プロセス制御中心

### 気づき
- Parser Combinatorが使いやすいので、テキスト処理が書きやすい
   - トラフィックデータ加工
   - 全文ログ検索にシステム向けにIRCログを加工
   - 認証データの加工処理、データ移行
   - ビルドシステム（Debianzing IBM DB2）
- STMがあるので、状態のあるマルチスレッドプログラムが書きやすい
- Domain Specific language(DSL)が定義しやすい
 - Monad
 - Haskell Relational Record(自作した)

### Haskell Relational Recordの紹介
- SQLを組み合わせるHaskell内DSL
- SQLの誤りをコンパイル時に発見
- 合成可能&型安全

### Q&A
- Haskellはメモリでハマりやすいので、最適な型指定を考えることが大事

## Haskell／Servantで行う安全かつ高速なAPI開発(nakaji-dayoさん)

### 用途
- Backend(WebAPI/Backend)

### Serventとは
- 薄いWeb Application Framework
- 機能がシンプル
- node: expressなどが類似
- 型レベルプログラミング
   - APIをhaskellの型を指定

### 開発スタイル
- APIを型で定義
   - 定義と実装の一致が保証されている
- Hander
   - 副作用のある計算が可能
   - API実装に必要な機能が備わっている
- servant-swagger
   - 実装とドキュメントがずれない
- servant-mock
   - モックサーバーの作成
- Handlerの拡張
   - Handlerに必要なモナドを合成する
- 型で設計上の制約を行う
   - 副作用実高可能、DBへの実行可能、HTTP的な例外を投げたりはできない
- viewの実装
   - HTML等を扱う場合は複数あるテンプレートエンジンの利用が可能（型安全なものをオススメする）
- REPLで殴る
   - エンドポイントw￥をテストしたい場合など、ghciで簡単に実行可能
- 型安全なことのメリット
   - 単純なバグを防ぐ
   - 自明なテストを書く必要がない
   - ほとんどのライブラリが型安全なので、全体を型安全にすることが可能

### 起きた問題
- 新しいもの(Firebaseなど)への対応
- マルチバイト対応
- 和暦・バグったcsvのパース
   - 逆にいうと、これくらいしかなかった

### まとめ
- 安全で、高速
   - 静的型付け、副作用の分離
   - 抽象度の高いデータ・ロジックを表現・実装

### 用途
 - Backend(WebAPI/Backend)

### Serventとは
 - 薄いWeb Application Framework
 - 機能がシンプル
 - node: expressなどが類似
 - 型レベルプログラミング
    - APIをhaskellの型を指定

### 開発スタイル
 - APIを型で定義
    - 定義と実装の一致が保証されている
 - Hander
    - 副作用のある計算が可能
    - API実装に必要な機能が備わっている
 - servant-swagger
    - 実装とドキュメントがずれない
 - servant-mock
    - モックサーバーの作成
 - Handlerの拡張
    - Handlerに必要なモナドを合成する
 - 型で設計上の制約を行う
    - 副作用実高可能、DBへの実行可能、HTTP的な例外を投げたりはできない
 - viewの実装
    - HTML等を扱う場合は複数あるテンプレートエンジンの利用が可能（型安全なものをオススメする）
 - REPLで殴る
    - エンドポイントw￥をテストしたい場合など、ghciで簡単に実行可能
 - 型安全なことのメリット
    - 単純なバグを防ぐ
    - 自明なテストを書く必要がない
    - ほとんどのライブラリが型安全なので、全体を型安全にすることが可能

### 起きた問題
 - 新しいもの(Firebaseなど)への対応
 - マルチバイト対応
 - 和暦・バグったcsvのパース
    - 逆にいうと、これくらいしかなかった

### まとめ
 - 安全で、高速
    - 静的型付け、副作用の分離
    - 抽象度の高いデータ・ロジックを表現・実装

## 並列平行言語Haskell(syocyさん)

 - Haskellによる並列・平行プログラミング
    - Haskeller以外にもオススメ
 - プロセッサ性能
    - シングルスレッドの性能が伸び悩む一方、物理CPU数は向上
    - プログラミングが必要
 - 並列平行言語の台頭
    - Go,Elixir,Rust(メモリ安全性)
 - Haskellの並列平行
    - 古くから並列・平行を考えて設計されてきた
    - 純粋なコードと副作用を含むコードを分離することで、並列性は決定的
    - 実行時システムが軽量スレッドのように使える
 - 並列と並行・分散
    - 並列：同時に走らせることで処理を高速化
    - 並行：同時性が擬似的でも良い
    - 分散：複数のマシンを使う処理のこと
       - 通信時間がかかるため、基本共有メモリを持たない
       - 一部のマシンがダウンする可能性もあり
 - 軽量スレッド
    - async関数で軽量スレッドを作る
    - 標準パッケージのforkIOの薄いラッパーで、より安全で便利
    - スレッド間通信
      - MVar
        - アクセスの公平性が保証される
      - STM(Software Transactional Memory)
        - 共有状態の読み書きにトランザクションの概念を導入
        - 複雑な共有状態の処理をミスなく記述しやすい
    - 並行構文の軽さはGoと同じくらいある
 - 並列Haskell
      - 並列に評価してほしい箇所を支持することが可能
      - par関数(第一引数の評価を並列化する)、pseq関数(直列化を指示)
      - 評価戦略という形で並列化指示を分離可能
 - より高レイヤのツール
      - prモナド
          - データフロー並列
          - パイプライン並列
      - Haxl
          - データソースへのクエリを自動的に並列化
      - repa
          - 行列計算について自動並列の一種、データ並行を適用
      - distributed-process
          - Haskellに分散型フレームワークを適用
      - ThreadScope
          - Haskellの実行時ログを可視化してくれる
 - 最新ニュース
      - ApplicationGo,-qnオプション、Cardanoで使われているCloud Haskell

## Dhall: Haskellの新たなキラーアプリ
 - 既存の設定ファイル言語への不満
    - 繰り返しの記述が必要
 - Dhall
    - 型・関数・インポートの機能がある
    - 無限ループが起こらない
    - 言語仕様は独立して管理されている
 - 型
    - Bool,Natural,Integer,Doubleなど
    - 複合型：List,Optional,Record(JSONのオブジェクトに相当),Union
 - インポート
    - ローカルパス・URL・Dhallファイルではないraw testからのインポートも可能
 - 導入
    - YAMLやJSONで設定作ってるし……でもOK！
    - dhall-to-yaml/dhall-to-jsonがある
    - DhallファイルをyamlやJSONに変換するコマンドラインツール
    - Kubernetesは大量にYAMLを用いる
      - 型を意識しなくても使用可能ではあるが、使用した方がスリムで便利になる
      - Unionで定義→Stringに戻す→yaml化
      - デフォルト値を作ると同じような値を何度も記述する必要がなくなる
    - dhallコマンドを導入するとフォーマッター、インタラクティブ環境が使用可能

## Semigroupとは？Monoidとは？環とは？
 - 代数とは？
    - Magra
      - <>, ++, + ：閉じた二項演算子
      - 何度も値を足すことができる
    - 二項演算とは二つの値を返す
 - 半群
    - マグマ+左右どちらから演算しても変わらない
    - 丸め誤差によって結合を満たさない→Double,Floatは半群になれない
 - Monoid
    - 半群+単位元 empty
    - 自明な初期値が定まった代数
 - Group(群)
    - モノイド+任意の元に対する逆元
    - モノイドであって群でない And, Orなど
    - ElGamal暗号などに応用が効く
    - 可換半群
 - 擬環
    - プロトコル
 - 環
    - 可換群 + モノイド
 - 体
    - 加法可換群 + 乗法可換群

## Haskellで作るCLI
 - コマンドライン引数
    - getArgs
    - GetOpt
        - getArgsで得た文字列を特定の型に変換してくれる
    - optparse-applicative
        - stackでも使われている、リッチなもの
    - extensible
 - Alt. Prelude
    - baseという標準パッケージにあるモジュール
    - 自動的にimportされる
    - プラグマでOFFにできる
 - RIOライブラリ
    - 大域環境・ログなど
 - stackテンプレート
    - stack:Haskellのビルドツール
    - 処理自体はGHC
    - プロジェクト内の書くパッケージのバージョン管理
    - 推しパッケージを入れる、自分のGithub情報を追加するなどをテンプレ化
    - GithubやGitlabなどのリポジトリに上げたテンプレートにアクセス可能

## gloss: 動かして遊んで学ぶHaskell
 - gross
      - 2Dグラフィックを簡単に描画できる
      - pictureをpictureに変形する関数
          - translate: 移動
          - scale: 拡大・縮小
      - 色を変えたり、回転させたりすることが可能
      - 二重振り子のシステムを作った
      - ライフゲーム
        - ブロック・ブリンカー・グライダー

## Listz あるいは永続データ構造を真に永続させる方法
  - 株取引アプリに使おうとしたが複雑すぎて没になった
  - 100GBまでなら使える
  - 似たライブラリにacid-stateあり
  - 安全性を保つため、書き込みはローカルのみ
