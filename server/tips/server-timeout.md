# API実行でタイムアウトが起きた時の対応方法

## タイムアウトは突然に

①原因の切り分け
 ・アプリケーション側のタイムアウトに引っかかっている（ex. php,laravel）
 ・ミドルウェアの設定値を超えている（ex. nginx,Apache）
 ・ロードバランサーのアイドルタイムアウトの設定値を超えている
 ・リソース不足でプロセスが死んでいる メモリ/CPU

②調査方法
　・設定ファイルを確認する
　・コードを精査する
　・スロークエリが出ていないか確認する
　・ログを確認する

③原因が明確な場合の対応
　・タイムアウトに引っかかっている場合
　　→　タイムアウトの値を確認、適正でなければ変更
　　　→　API/クエリの実行に数秒を要するようであればそもそもコードかクエリがイケてない
　・リソース不足の場合
　　→ そもそも冗長なコード/クエリになっていないかを確認
　　→ アプリケーション側に問題がなさそうならリソースの調整

④イケてないコード/クエリを書いていたら
　・コードならレスポンスタイム、クエリならDBのログ等から実行時間を確認
　・イケてるかイケてないかも判断がつかないなら、第三者に見てもらう
　・単純に時間がかかっている場合、コードなら並行/並列等、クエリならインデックスの適用等を検討

⑤それでも直らない場合
　・もっと根本的な構成・設定を見直す
　　→ そもそもDB設計が悪い？
　　→ 仕様変えれないか？
　　→ キャッシュ効かせてる？
　　→ RDMS使わずにElastic Search,Redisなどを導入するべき？
